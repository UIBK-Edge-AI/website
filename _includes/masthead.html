{% include base_path %}

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        <button class="hidden"><div class="navicon"></div></button>
        <ul class="visible-links">
          <li class="masthead__menu-item masthead__menu-item--lg persist">
            <a href="https://www.uibk.ac.at/informatik/" target="_blank" rel="noopener noreferrer">
              <img 
                id="site-logo"
                src="{{ base_path }}/images/light.svg" 
                data-light="{{ base_path }}/images/light.svg"
                data-dark="{{ base_path }}/images/black.svg"
                alt="university_innsbruck_logo" 
                class="site-logo"
              >
            </a>
          </li>
          {% for link in site.data.navigation.main %}
            {% if link.dropdown %}
              <!-- Dropdown Navigation Item -->
              <li class="masthead__menu-item dropdown-item{% if page.url contains link.url %} active{% endif %}">
                <a href="{% if link.url contains 'http' %}{{ link.url }}{% else %}{{ base_path }}{{ link.url }}{% endif %}" class="dropdown-toggle">
                  {{ link.title }}
                  <i class="fa-solid fa-chevron-down dropdown-arrow" aria-hidden="true"></i>
                </a>
                <ul class="dropdown-menu">
                  {% for dropdown_item in link.dropdown_items %}
                    <li class="dropdown-menu-item">
                      <a href="{% if dropdown_item.url contains 'http' %}{{ dropdown_item.url }}{% else %}{{ base_path }}{{ dropdown_item.url }}{% endif %}" 
                         data-filter="{{ dropdown_item.filter }}"
                         onclick="handleDropdownNavigation('{{ dropdown_item.filter }}', event)">
                        {% if dropdown_item.icon %}
                          <span class="dropdown-icon">{{ dropdown_item.icon }}</span>
                        {% endif %}
                        {{ dropdown_item.title }}
                      </a>
                    </li>
                  {% endfor %}
                </ul>
              </li>
            {% else %}
              <!-- Regular Navigation Item -->
              {% if link.url contains 'http' %}
                {% assign domain = '' %}
              {% else %}
                {% assign domain = base_path %}
              {% endif %}
              <li class="masthead__menu-item{% if page.url == link.url %} active{% endif %}">
                <a href="{{ domain }}{{ link.url }}">{{ link.title }}</a>
              </li>
            {% endif %}
          {% endfor %}
          <li id="theme-toggle" class="masthead__menu-item persist tail">
            <a><i id="theme-icon" class="fa-solid fa-sun" aria-hidden="true" title="toggle theme"></i></a>
          </li>
        </ul>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>

<style>
/* Force horizontal layout and ensure theme toggle shows */
.greedy-nav {
  display: flex !important;
  align-items: center !important;
}

.greedy-nav .visible-links {
  display: flex !important;
  align-items: center !important;
  width: 100% !important;
  flex-wrap: nowrap !important;
}

.greedy-nav .visible-links li {
  display: flex !important;
  align-items: center !important;
  white-space: nowrap !important;
}

/* Ensure theme toggle stays visible and on the right */
#theme-toggle {
  margin-left: auto !important;
  display: flex !important;
}

#theme-toggle a {
  display: flex !important;
  align-items: center !important;
  justify-content: center !important;
  width: 25px !important;
  height: 25px !important;
}

/* Hide hamburger button completely */
.greedy-nav button {
  display: none !important;
}

/* Force all navigation items to be visible */
.masthead__menu-item {
  display: flex !important;
  align-items: center !important;
}

/* Fix dropdown toggle to match other nav items - COMPACT VERSION */
.masthead__menu-item.dropdown-item .dropdown-toggle {
  padding: 0.5rem 1rem !important;
  margin: 0 1rem !important;
  border-bottom: none !important;
  background: none !important;
  height: auto !important;
  min-height: auto !important;
}

/* Reset any conflicting styles */
.masthead__menu-item.dropdown-item .dropdown-toggle {
  font-weight: normal !important;
  color: var(--global-masthead-link-color) !important;
}

/* Ensure dropdown appears as overlay */
.dropdown-menu {
  position: absolute !important;
  top: 100% !important;
  left: 0 !important;
  right: auto !important;
  transform: translateY(-12px) !important;
  z-index: 9999 !important;
}

.masthead__menu-item.dropdown-item.open .dropdown-menu {
  transform: translateY(0) !important;
}

/* Keep Research tab highlighted when dropdown is open */
.masthead__menu-item.dropdown-item.open .dropdown-toggle {
  background-color: rgba(0, 123, 255, 0.1) !important;
  color: #007bff !important;
}

.masthead__menu-item.dropdown-item.open .dropdown-arrow {
  color: #007bff !important;
  transform: rotate(180deg) !important;
}

/* Fix masthead height - prevent expansion */
.masthead {
  position: relative;
  overflow: visible !important;
  min-height: auto !important;
}

.masthead__inner-wrap {
  position: relative;
  overflow: visible !important;
  min-height: auto !important;
}

/* Dropdown arrow positioning */
.dropdown-arrow {
  margin-left: 6px !important;
  font-size: 12px !important;
}

/* Force compact masthead */
.masthead__menu {
  min-height: auto !important;
}

.greedy-nav {
  min-height: auto !important;
  padding: 0 !important;
}
</style>

<script>
// Simple dropdown functionality that works with greedy-nav
// Simple dropdown functionality that works with greedy-nav
(function() {
  'use strict';

  function initializeDropdowns() {
    const dropdownItems = document.querySelectorAll('.masthead__menu-item.dropdown-item');
    
    dropdownItems.forEach(function(item) {
      const toggle = item.querySelector('.dropdown-toggle');
      const dropdown = item.querySelector('.dropdown-menu');
      
      if (toggle && dropdown) {
        let hoverTimeout;

        // Show dropdown on mouseenter
        item.addEventListener('mouseenter', function(e) {
          clearTimeout(hoverTimeout);
          
          // Close other dropdowns
          dropdownItems.forEach(function(otherItem) {
            if (otherItem !== item) {
              otherItem.classList.remove('open');
            }
          });
          
          // Open current dropdown
          item.classList.add('open');
        });
        
        // Hide dropdown on mouseleave with slight delay
        item.addEventListener('mouseleave', function(e) {
          hoverTimeout = setTimeout(function() {
            item.classList.remove('open');
          }, 100);
        });

        // Keep dropdown open when hovering over dropdown menu
        dropdown.addEventListener('mouseenter', function(e) {
          clearTimeout(hoverTimeout);
          item.classList.add('open');
        });

        dropdown.addEventListener('mouseleave', function(e) {
          hoverTimeout = setTimeout(function() {
            item.classList.remove('open');
          }, 100);
        });
      }
    });
  }

  // Handle dropdown navigation with filtering
  window.handleDropdownNavigation = function(filter, event) {
    if (window.location.pathname.includes('/research/')) {
      event.preventDefault();
      
      if (window.researchFilter) {
        window.researchFilter.filterByCategory(filter);
      }
      
      // Close dropdown
      document.querySelectorAll('.dropdown-item').forEach(function(item) {
        item.classList.remove('open');
      });
      
      const newUrl = `/research/${filter !== 'all' ? '?filter=' + filter : ''}`;
      window.history.pushState({filter: filter}, '', newUrl);
      
      return false;
    }
  };

  // Disable greedy-nav functionality to keep all tabs visible
  function disableGreedyNav() {
    if (window.updateNav) {
      window.updateNav = function() {
        var mastheadHeight = $('.masthead').height();
        $('body').css('padding-top', mastheadHeight + 'px');
        if ($(".author__urls-wrapper button").is(":visible")) {
          $(".sidebar").css("padding-top", "");
        } else {
          $(".sidebar").css("padding-top", mastheadHeight + "px");
        }
      };
    }
  }

  // Initialize when DOM is ready
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', function() {
      initializeDropdowns();
      disableGreedyNav();
    });
  } else {
    initializeDropdowns();
    disableGreedyNav();
  }
})();
</script>